name: Android CI (GitSafe ZIP Build)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout your repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Set up Java JDK 17 (required for modern Android builds)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      # 3Ô∏è‚É£ Confirm ZIP exists and list repo contents
      - name: Verify repository contents
        run: |
          echo "üìÇ Repository structure:"
          ls -R

      # 4Ô∏è‚É£ Extract GitSafe.zip into a subfolder (extracted-project)
      - name: Extract project ZIP
        run: |
          echo "üì¶ Extracting GitSafe.zip..."
          unzip -o GitSafe.zip -d extracted-project
          echo "‚úÖ Extraction complete. Listing extracted files:"
          ls -R extracted-project

      # 5Ô∏è‚É£ Give Gradlew permission to execute
      - name: Grant execute permission for Gradlew
        run: chmod +x extracted-project/GitSafe/gradlew

      # 6Ô∏è‚É£ Build Debug and Release APKs with Gradle
      - name: Build Debug and Release APKs
        working-directory: extracted-project/GitSafe
        run: ./gradlew clean assembleDebug assembleRelease --stacktrace

      # 7Ô∏è‚É£ Upload generated APKs as build artifacts
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: DeskChat-APKs
          path: |
            extracted-project/GitSafe/app/build/outputs/apk/debug/*.apk
            extracted-project/GitSafe/app/build/outputs/apk/release/*.apk